{"ast":null,"code":"import React,{useRef,useEffect,useContext}from'react';import\"xterm/css/xterm.css\";import{Terminal}from'xterm';import\"./LocalTerminal.css\";import{v4}from'uuid';import SettingsContext from'../Contexts/SettingsContext';var LocalTerminal=function LocalTerminal(_ref){var su=_ref.su,scripts=_ref.scripts,clear=_ref.clear,unmount=_ref.unmount;var settings=useContext(SettingsContext);var crusterDir=settings.crusterDir,sudoPassword=settings.sudoPassword;var ref=useRef({});useEffect(function(){if(!ref.current)return function(){};var id=v4();ipcRenderer.send(\"local-terminal\",{id:id,sudoPassword:sudoPassword});var onReady=function onReady(event,msg){if(msg.id===id){if(su){ipcRenderer.send(\"local-terminal-data\",{id:id,data:\"sudo su\\n\"});ipcRenderer.send(\"local-terminal-data\",{id:id,data:sudoPassword.trim()+\"\\n\"});}setTimeout(function(){ipcRenderer.send(\"local-terminal-run-scripts\",{id:id,env:{CRUSTER_DIR:crusterDir,IMG_NAME:\"node\"},scripts:scripts});var onCompleted=function onCompleted(event,msg){if(msg.id===id){ipcRenderer.off('local-terminal-complete',onCompleted);if(clear){ipcRenderer.send(\"local-terminal-data\",{id:id,data:\"clear\\n\"});}}};ipcRenderer.on('local-terminal-complete',onCompleted);},500);}ipcRenderer.off(\"local-terminal-ready\",onReady);};ipcRenderer.on(\"local-terminal-ready\",onReady);var onData=function onData(event,msg){var data=msg.data;if(msg.id===id){term.write(data);}};var onClose=function onClose(event,msg){if(id===msg.id){ipcRenderer.off('local-terminal-data',onData);ipcRenderer.off('local-terminal-error',onData);ipcRenderer.off('local-terminal-exit-code',onClose);ipcRenderer.off('local-terminal-done',onDone);ipcRenderer.send(\"local-terminal-data\",{id:id,data:\"exit\\n\"});}};var onDone=function onDone(event,msg){console.log(\"done\");};ipcRenderer.on('local-terminal-done',onDone);ipcRenderer.on('local-terminal-data',onData);ipcRenderer.on('local-terminal-error',onData);ipcRenderer.on('local-terminal-exit-code',onClose);var term=new Terminal({cols:80,rows:24});term.open(ref.current);term.onData(function(data){ipcRenderer.send(\"local-terminal-data\",{id:id,data:data});});return function(){if(unmount){ipcRenderer.send(\"local-terminal-unmount-exit\",{id:id});}else{ipcRenderer.send(\"local-terminal-end\",{id:id});}};},[ref]);return/*#__PURE__*/React.createElement(\"div\",{id:\"terminal\",ref:ref});};export default LocalTerminal;","map":{"version":3,"sources":["C:/Users/zwhit/dev/cruster/app/src/Terminals/LocalTerminal.tsx"],"names":["React","useRef","useEffect","useContext","Terminal","v4","SettingsContext","LocalTerminal","su","scripts","clear","unmount","settings","crusterDir","sudoPassword","ref","current","id","ipcRenderer","send","onReady","event","msg","data","trim","setTimeout","env","CRUSTER_DIR","IMG_NAME","onCompleted","off","on","onData","term","write","onClose","onDone","console","log","cols","rows","open"],"mappings":"AAAA,MAAOA,CAAAA,KAAP,EAAgBC,MAAhB,CAAwBC,SAAxB,CAA6CC,UAA7C,KAA+D,OAA/D,CACA,MAAO,qBAAP,CACA,OAASC,QAAT,KAAyB,OAAzB,CACA,MAAO,qBAAP,CAGA,OAAQC,EAAR,KAAiB,MAAjB,CACA,MAAOC,CAAAA,eAAP,KAA4B,6BAA5B,CAIA,GAAMC,CAAAA,aAAa,CAAG,QAAhBA,CAAAA,aAAgB,MAAmC,IAAjCC,CAAAA,EAAiC,MAAjCA,EAAiC,CAA7BC,OAA6B,MAA7BA,OAA6B,CAApBC,KAAoB,MAApBA,KAAoB,CAAbC,OAAa,MAAbA,OAAa,CACvD,GAAMC,CAAAA,QAAQ,CAAGT,UAAU,CAACG,eAAD,CAA3B,CADuD,GAEhDO,CAAAA,UAFgD,CAEpBD,QAFoB,CAEhDC,UAFgD,CAEpCC,YAFoC,CAEpBF,QAFoB,CAEpCE,YAFoC,CAGvD,GAAMC,CAAAA,GAAO,CAAGd,MAAM,CAAC,EAAD,CAAtB,CACAC,SAAS,CAAC,UAAM,CACd,GAAI,CAACa,GAAG,CAACC,OAAT,CAAkB,MAAO,WAAM,CAAE,CAAf,CAClB,GAAMC,CAAAA,EAAE,CAAGZ,EAAE,EAAb,CACAa,WAAW,CAACC,IAAZ,CAAiB,gBAAjB,CAAmC,CACjCF,EAAE,CAAFA,EADiC,CAEjCH,YAAY,CAAZA,YAFiC,CAAnC,EAKA,GAAMM,CAAAA,OAAO,CAAG,QAAVA,CAAAA,OAAU,CAACC,KAAD,CAAQC,GAAR,CAAgB,CAC9B,GAAIA,GAAG,CAACL,EAAJ,GAAWA,EAAf,CAAmB,CACjB,GAAIT,EAAJ,CAAQ,CACNU,WAAW,CAACC,IAAZ,CAAiB,qBAAjB,CAAwC,CACtCF,EAAE,CAAFA,EADsC,CAEtCM,IAAI,CAAE,WAFgC,CAAxC,EAIAL,WAAW,CAACC,IAAZ,CAAiB,qBAAjB,CAAwC,CACtCF,EAAE,CAAFA,EADsC,CAEtCM,IAAI,CAAET,YAAY,CAACU,IAAb,GAAsB,IAFU,CAAxC,EAID,CAEDC,UAAU,CAAC,UAAM,CACfP,WAAW,CAACC,IAAZ,CAAiB,4BAAjB,CAA+C,CAC7CF,EAAE,CAAFA,EAD6C,CAE7CS,GAAG,CAAE,CACHC,WAAW,CAAEd,UADV,CAEHe,QAAQ,CAAE,MAFP,CAFwC,CAM7CnB,OAAO,CAAPA,OAN6C,CAA/C,EAQA,GAAMoB,CAAAA,WAAW,CAAG,QAAdA,CAAAA,WAAc,CAACR,KAAD,CAAQC,GAAR,CAAgB,CAClC,GAAIA,GAAG,CAACL,EAAJ,GAAWA,EAAf,CAAmB,CACjBC,WAAW,CAACY,GAAZ,CAAgB,yBAAhB,CAA2CD,WAA3C,EACA,GAAInB,KAAJ,CAAW,CACTQ,WAAW,CAACC,IAAZ,CAAiB,qBAAjB,CAAwC,CACtCF,EAAE,CAAFA,EADsC,CAEtCM,IAAI,CAAE,SAFgC,CAAxC,EAID,CACF,CACF,CAVD,CAWAL,WAAW,CAACa,EAAZ,CAAe,yBAAf,CAA0CF,WAA1C,EACD,CArBS,CAqBR,GArBQ,CAAV,CAsBD,CACDX,WAAW,CAACY,GAAZ,CAAgB,sBAAhB,CAAwCV,OAAxC,EACD,CArCD,CAuCAF,WAAW,CAACa,EAAZ,CAAe,sBAAf,CAAuCX,OAAvC,EAIA,GAAMY,CAAAA,MAAM,CAAG,QAATA,CAAAA,MAAS,CAACX,KAAD,CAAQC,GAAR,CAAgB,IACtBC,CAAAA,IADsB,CACdD,GADc,CACtBC,IADsB,CAE7B,GAAID,GAAG,CAACL,EAAJ,GAAWA,EAAf,CAAmB,CACjBgB,IAAI,CAACC,KAAL,CAAWX,IAAX,EACD,CACF,CALD,CAOA,GAAMY,CAAAA,OAAO,CAAG,QAAVA,CAAAA,OAAU,CAACd,KAAD,CAAQC,GAAR,CAAgB,CAC9B,GAAIL,EAAE,GAAKK,GAAG,CAACL,EAAf,CAAmB,CACjBC,WAAW,CAACY,GAAZ,CAAgB,qBAAhB,CAAuCE,MAAvC,EACAd,WAAW,CAACY,GAAZ,CAAgB,sBAAhB,CAAwCE,MAAxC,EACAd,WAAW,CAACY,GAAZ,CAAgB,0BAAhB,CAA4CK,OAA5C,EACAjB,WAAW,CAACY,GAAZ,CAAgB,qBAAhB,CAAuCM,MAAvC,EACElB,WAAW,CAACC,IAAZ,CAAiB,qBAAjB,CAAwC,CACtCF,EAAE,CAAFA,EADsC,CAEtCM,IAAI,CAAE,QAFgC,CAAxC,EAIH,CACF,CAXD,CAaA,GAAMa,CAAAA,MAAM,CAAG,QAATA,CAAAA,MAAS,CAACf,KAAD,CAAQC,GAAR,CAAgB,CAC7Be,OAAO,CAACC,GAAR,CAAY,MAAZ,EACD,CAFD,CAIApB,WAAW,CAACa,EAAZ,CAAe,qBAAf,CAAsCK,MAAtC,EACAlB,WAAW,CAACa,EAAZ,CAAe,qBAAf,CAAsCC,MAAtC,EACAd,WAAW,CAACa,EAAZ,CAAe,sBAAf,CAAuCC,MAAvC,EACAd,WAAW,CAACa,EAAZ,CAAe,0BAAf,CAA2CI,OAA3C,EACA,GAAMF,CAAAA,IAAI,CAAG,GAAI7B,CAAAA,QAAJ,CAAa,CAAEmC,IAAI,CAAE,EAAR,CAAYC,IAAI,CAAE,EAAlB,CAAb,CAAb,CACAP,IAAI,CAACQ,IAAL,CAAU1B,GAAG,CAACC,OAAd,EACAiB,IAAI,CAACD,MAAL,CAAY,SAAAT,IAAI,CAAI,CAClBL,WAAW,CAACC,IAAZ,CAAiB,qBAAjB,CAAwC,CACtCF,EAAE,CAAFA,EADsC,CAEtCM,IAAI,CAAJA,IAFsC,CAAxC,EAID,CALD,EAOA,MAAO,WAAM,CACX,GAAIZ,OAAJ,CAAa,CACXO,WAAW,CAACC,IAAZ,CAAiB,6BAAjB,CAAgD,CAACF,EAAE,CAAFA,EAAD,CAAhD,EACD,CAFD,IAEO,CACLC,WAAW,CAACC,IAAZ,CAAiB,oBAAjB,CAAuC,CAACF,EAAE,CAAFA,EAAD,CAAvC,EACD,CACF,CAND,CAOD,CA/FQ,CA+FN,CAACF,GAAD,CA/FM,CAAT,CAkGA,mBACE,2BAAK,EAAE,CAAC,UAAR,CAAmB,GAAG,CAAEA,GAAxB,EADF,CAGD,CAzGD,CA2GA,cAAeR,CAAAA,aAAf","sourcesContent":["import React, { useRef, useEffect, useState, useContext } from 'react'\r\nimport \"xterm/css/xterm.css\"\r\nimport { Terminal } from 'xterm'\r\nimport \"./LocalTerminal.css\"\r\nimport { WebLinksAddon } from 'xterm-addon-web-links'\r\nimport { dialog } from 'electron'\r\nimport {v4} from 'uuid'\r\nimport SettingsContext from '../Contexts/SettingsContext';\r\n\r\ndeclare var ipcRenderer;\r\n\r\nconst LocalTerminal = ({su, scripts, clear, unmount}) => {\r\n  const settings = useContext(SettingsContext)\r\n  const {crusterDir, sudoPassword} = settings\r\n  const ref:any = useRef({})\r\n  useEffect(() => {\r\n    if (!ref.current) return () => {}\r\n    const id = v4()\r\n    ipcRenderer.send(\"local-terminal\", {\r\n      id,\r\n      sudoPassword,\r\n    })\r\n\r\n    const onReady = (event, msg) => {\r\n      if (msg.id === id) {\r\n        if (su) {\r\n          ipcRenderer.send(\"local-terminal-data\", {\r\n            id,\r\n            data: \"sudo su\\n\",\r\n          })\r\n          ipcRenderer.send(\"local-terminal-data\", {\r\n            id,\r\n            data: sudoPassword.trim() + \"\\n\",\r\n          })\r\n        }\r\n\r\n        setTimeout(() => {\r\n          ipcRenderer.send(\"local-terminal-run-scripts\", {\r\n            id,\r\n            env: {\r\n              CRUSTER_DIR: crusterDir,\r\n              IMG_NAME: \"node\"\r\n            },\r\n            scripts,\r\n          })\r\n          const onCompleted = (event, msg) => {\r\n            if (msg.id === id) {\r\n              ipcRenderer.off('local-terminal-complete', onCompleted)\r\n              if (clear) {\r\n                ipcRenderer.send(\"local-terminal-data\", {\r\n                  id,\r\n                  data: \"clear\\n\",\r\n                })\r\n              }\r\n            }\r\n          }\r\n          ipcRenderer.on('local-terminal-complete', onCompleted)\r\n        },500)\r\n      }\r\n      ipcRenderer.off(\"local-terminal-ready\", onReady)\r\n    }\r\n\r\n    ipcRenderer.on(\"local-terminal-ready\", onReady)\r\n\r\n\r\n\r\n    const onData = (event, msg) => {\r\n      const {data} = msg\r\n      if (msg.id === id) {\r\n        term.write(data)\r\n      }\r\n    }\r\n\r\n    const onClose = (event, msg) => {\r\n      if (id === msg.id) {\r\n        ipcRenderer.off('local-terminal-data', onData)\r\n        ipcRenderer.off('local-terminal-error', onData)\r\n        ipcRenderer.off('local-terminal-exit-code', onClose)\r\n        ipcRenderer.off('local-terminal-done', onDone)\r\n          ipcRenderer.send(\"local-terminal-data\", {\r\n            id,\r\n            data: \"exit\\n\",\r\n          })\r\n      }\r\n    }\r\n\r\n    const onDone = (event, msg) => {\r\n      console.log(\"done\")\r\n    }\r\n\r\n    ipcRenderer.on('local-terminal-done', onDone)\r\n    ipcRenderer.on('local-terminal-data', onData)\r\n    ipcRenderer.on('local-terminal-error', onData)\r\n    ipcRenderer.on('local-terminal-exit-code', onClose)\r\n    const term = new Terminal({ cols: 80, rows: 24})\r\n    term.open(ref.current)\r\n    term.onData(data => {\r\n      ipcRenderer.send(\"local-terminal-data\", {\r\n        id,\r\n        data,\r\n      })\r\n    })\r\n\r\n    return () => {\r\n      if (unmount) {\r\n        ipcRenderer.send(\"local-terminal-unmount-exit\", {id})\r\n      } else {\r\n        ipcRenderer.send(\"local-terminal-end\", {id})\r\n      }\r\n    }\r\n  }, [ref])\r\n\r\n\r\n  return (\r\n    <div id=\"terminal\" ref={ref} />\r\n  )\r\n}\r\n\r\nexport default LocalTerminal"]},"metadata":{},"sourceType":"module"}