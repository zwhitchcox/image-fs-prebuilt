{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\zwhit\\\\dev\\\\cruster\\\\app\\\\src\\\\Clusters\\\\Manage\\\\ManageClusters.tsx\";\nimport React, { useContext, useState } from 'react';\nimport SystemInfoContext from '../../Contexts/SystemInfoContext';\nimport { Link, useHistory } from 'react-router-dom';\nimport ActionsContext from '../../Contexts/ActionsContext';\n\nconst lastNumIP = ip => Number(ip.split('.')[3]);\n\nconst sortByMasterIP = (a, b) => lastNumIP(a.masterip) - lastNumIP(b.masterip);\n\nconst ManageClusters = () => {\n  const {\n    nodes\n  } = useContext(SystemInfoContext);\n  const clusters = Object.values(nodes).reduce((prev, cur) => {\n    const {\n      masterip,\n      clustername\n    } = cur;\n    if (!masterip) return prev;\n\n    if (!prev[masterip]) {\n      prev[masterip] = {\n        clustername,\n        masterip: masterip,\n        master: {},\n        slaves: []\n      };\n    }\n\n    if (cur.status === \"SLAVE\") {\n      prev[masterip].slaves.push(cur);\n    } else if (cur.status === \"MASTER\") {\n      prev[masterip].master = cur;\n    }\n\n    return prev;\n  }, {});\n  let clustersArr = Object.values(clusters);\n  clustersArr.sort(sortByMasterIP);\n  clustersArr = clustersArr.filter(cluster => {\n    return cluster.masterip !== \"\";\n  });\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"boxed\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 35,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"h3\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 36,\n      columnNumber: 7\n    }\n  }, \"Manage Clusters\"), Object.values(clusters).map(cluster => /*#__PURE__*/React.createElement(Cluster, {\n    key: cluster.masterip,\n    cluster: cluster,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 37,\n      columnNumber: 53\n    }\n  })), /*#__PURE__*/React.createElement(Link, {\n    to: \"/clusters/reset-all\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 38,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"button\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 39,\n      columnNumber: 9\n    }\n  }, \"Go Nuclear - Reset All\")), /*#__PURE__*/React.createElement(\"br\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 41,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(Link, {\n    to: \"/clusters/run-cmd-all\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 42,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"button\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 43,\n      columnNumber: 9\n    }\n  }, \"Run Command on All Pis At Once\")));\n};\n\nconst Cluster = ({\n  cluster\n}) => {\n  const history = useHistory();\n  const {\n    runAction\n  } = useContext(ActionsContext);\n  const [kubeStatus, setKubeStatus] = useState(\"\");\n\n  const downloadKube = async () => {\n    setKubeStatus(\"Downloading...\");\n\n    try {\n      await runAction({\n        type: \"scp-download\",\n        args: {\n          ip: cluster.master.masterip,\n          remotePath: \"/root/.kube/config\",\n          localPath: ipcRenderer.sendSync(\"kube-config-path\")\n        }\n      });\n    } catch (error) {\n      setKubeStatus(error.toString());\n    }\n\n    setKubeStatus(\"Copied successfully!\");\n  };\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 71,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"h4\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 72,\n      columnNumber: 7\n    }\n  }, cluster.clustername), \"Master: \", /*#__PURE__*/React.createElement(\"br\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 73,\n      columnNumber: 15\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"indent-1\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 73,\n      columnNumber: 21\n    }\n  }, cluster.master.ip, \"\\xA0\\xA0\", /*#__PURE__*/React.createElement(\"span\", {\n    className: \"action\",\n    onClick: () => history.push(`/clusters/node-ssh/${cluster.master.ip}`),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 75,\n      columnNumber: 9\n    }\n  }, \"ssh\"), /*#__PURE__*/React.createElement(\"span\", {\n    className: \"action\",\n    onClick: () => history.push(`/clusters/node-ssh/${cluster.master.ip}/reset`),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 76,\n      columnNumber: 9\n    }\n  }, \"reset\")), \"Slaves: \", /*#__PURE__*/React.createElement(\"table\", {\n    className: \"indent-1\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 81,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(\"tbody\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 82,\n      columnNumber: 9\n    }\n  }, cluster.slaves.map(({\n    ip\n  }) => /*#__PURE__*/React.createElement(SlaveNode, {\n    key: ip,\n    ip: ip,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 83,\n      columnNumber: 37\n    }\n  })))), \"Actions:\", /*#__PURE__*/React.createElement(\"ul\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 87,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"li\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 88,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"span\", {\n    className: \"action\",\n    onClick: downloadKube,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 88,\n      columnNumber: 13\n    }\n  }, \"get kube config\"), \" \", kubeStatus)));\n};\n\nconst SlaveNode = ({\n  ip\n}) => {\n  const history = useHistory();\n  return /*#__PURE__*/React.createElement(\"tr\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 95,\n      columnNumber: 10\n    }\n  }, /*#__PURE__*/React.createElement(\"td\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 96,\n      columnNumber: 5\n    }\n  }, ip, \"\\xA0\\xA0\"), /*#__PURE__*/React.createElement(\"td\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 99,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"span\", {\n    className: \"action\",\n    onClick: () => history.push(`/clusters/node-ssh/${ip}`),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 100,\n      columnNumber: 7\n    }\n  }, \"ssh\")), /*#__PURE__*/React.createElement(\"td\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 102,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"span\", {\n    className: \"action\",\n    onClick: () => history.push(`/clusters/node-ssh/${ip}/reset`),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 103,\n      columnNumber: 5\n    }\n  }, \"reset\")));\n};\n\nexport default ManageClusters;","map":{"version":3,"sources":["C:/Users/zwhit/dev/cruster/app/src/Clusters/Manage/ManageClusters.tsx"],"names":["React","useContext","useState","SystemInfoContext","Link","useHistory","ActionsContext","lastNumIP","ip","Number","split","sortByMasterIP","a","b","masterip","ManageClusters","nodes","clusters","Object","values","reduce","prev","cur","clustername","master","slaves","status","push","clustersArr","sort","filter","cluster","map","Cluster","history","runAction","kubeStatus","setKubeStatus","downloadKube","type","args","remotePath","localPath","ipcRenderer","sendSync","error","toString","SlaveNode"],"mappings":"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","sourcesContent":["import React, { useContext, useState } from 'react'\r\nimport SystemInfoContext from '../../Contexts/SystemInfoContext';\r\nimport { Link, useHistory } from 'react-router-dom';\r\nimport ActionsContext from '../../Contexts/ActionsContext';\r\n\r\nconst lastNumIP = ip => Number(ip.split('.')[3])\r\nconst sortByMasterIP = (a, b) => lastNumIP(a.masterip) - lastNumIP(b.masterip)\r\n\r\nconst ManageClusters = () => {\r\n  const {nodes} = useContext(SystemInfoContext)\r\n  const clusters = Object.values(nodes).reduce((prev, cur:any) => {\r\n    const {masterip, clustername} = cur\r\n    if (!masterip) return prev\r\n    if (!prev[masterip]) {\r\n      prev[masterip] = {\r\n        clustername,\r\n        masterip: masterip,\r\n        master: {} as any,\r\n        slaves: [] as any[],\r\n      }\r\n    }\r\n    if (cur.status === \"SLAVE\") {\r\n      prev[masterip].slaves.push(cur)\r\n    } else if (cur.status === \"MASTER\") {\r\n      prev[masterip].master = cur\r\n    }\r\n    return prev\r\n  }, ({} as any))\r\n  let clustersArr: any[] = Object.values(clusters)\r\n  clustersArr.sort(sortByMasterIP)\r\n  clustersArr = clustersArr.filter((cluster) => {\r\n    return cluster.masterip !== \"\"\r\n  })\r\n  return (\r\n    <div className=\"boxed\">\r\n      <h3>Manage Clusters</h3>\r\n      {Object.values(clusters).map((cluster:any) => <Cluster key={cluster.masterip} cluster={cluster} />)}\r\n      <Link to=\"/clusters/reset-all\">\r\n        <button>Go Nuclear - Reset All</button>\r\n      </Link>\r\n      <br />\r\n      <Link to=\"/clusters/run-cmd-all\">\r\n        <button>Run Command on All Pis At Once</button>\r\n      </Link>\r\n    </div>\r\n  )\r\n}\r\n\r\nconst Cluster = ({cluster}) => {\r\n  const history = useHistory()\r\n  const {runAction} = useContext(ActionsContext)\r\n  const [kubeStatus, setKubeStatus] = useState(\"\")\r\n  const downloadKube = async () => {\r\n    setKubeStatus(\"Downloading...\")\r\n    try {\r\n      await runAction({\r\n        type: \"scp-download\",\r\n        args: {\r\n          ip: cluster.master.masterip,\r\n          remotePath: \"/root/.kube/config\",\r\n          localPath: ipcRenderer.sendSync(\"kube-config-path\"),\r\n        }\r\n      })\r\n    } catch (error) {\r\n      setKubeStatus(error.toString())\r\n    }\r\n    setKubeStatus(\"Copied successfully!\")\r\n  }\r\n\r\n  return (\r\n    <div>\r\n      <h4>{cluster.clustername}</h4>\r\n      Master: <br /><div className=\"indent-1\">\r\n        {cluster.master.ip}&nbsp;&nbsp;\r\n        <span className=\"action\" onClick={() => history.push(`/clusters/node-ssh/${cluster.master.ip}`)}>ssh</span>\r\n        <span\r\n            className=\"action\"\r\n            onClick={() => history.push(`/clusters/node-ssh/${cluster.master.ip}/reset`)}\r\n          >reset</span>\r\n        </div>\r\n      Slaves: <table className=\"indent-1\">\r\n        <tbody>\r\n      {cluster.slaves.map(({ip}) => <SlaveNode key={ip} ip={ip} />)}\r\n        </tbody>\r\n      </table>\r\n      Actions:\r\n      <ul>\r\n        <li><span className=\"action\" onClick={downloadKube}>get kube config</span> {kubeStatus}</li>\r\n      </ul>\r\n    </div>\r\n  )\r\n}\r\nconst SlaveNode = ({ip}) => {\r\n  const history = useHistory()\r\n  return <tr>\r\n    <td>\r\n    {ip}&nbsp;&nbsp;\r\n    </td>\r\n    <td>\r\n      <span className=\"action\" onClick={() => history.push(`/clusters/node-ssh/${ip}`)}>ssh</span>\r\n    </td>\r\n    <td>\r\n    <span\r\n        className=\"action\"\r\n        onClick={() => history.push(`/clusters/node-ssh/${ip}/reset`)}\r\n      >reset</span>\r\n    </td>\r\n  </tr>\r\n}\r\n\r\nexport default ManageClusters"]},"metadata":{},"sourceType":"module"}