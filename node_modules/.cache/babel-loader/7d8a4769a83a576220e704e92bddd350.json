{"ast":null,"code":"import _regeneratorRuntime from\"C:\\\\Users\\\\zwhit\\\\dev\\\\cruster\\\\app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _asyncToGenerator from\"C:\\\\Users\\\\zwhit\\\\dev\\\\cruster\\\\app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";import _objectSpread from\"C:\\\\Users\\\\zwhit\\\\dev\\\\cruster\\\\app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"C:\\\\Users\\\\zwhit\\\\dev\\\\cruster\\\\app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from'react';import{BrowserRouter as Router,Switch,Route,Link}from\"react-router-dom\";import'./App.css';import Clusters from'./Clusters/Clusters';import Image from'./Image/Image';import Settings from'./Cmpt/Settings';import GearIcon from\"./Cmpt/GearIcon.svg\";import LogIcon from\"./Cmpt/LogIcon.svg\";import Log from'./Cmpt/Log';import SettingsContext from'./Contexts/SettingsContext';import{v4}from'uuid';import ActionsContext from'./Contexts/ActionsContext';import SystemInfoContext from'./Contexts/SystemInfoContext';import{Terminal}from'xterm';import\"xterm/css/xterm.css\";var _log=\"\";function App(){var _useState=useState(false),_useState2=_slicedToArray(_useState,2),settingsOpen=_useState2[0],setSettingsOpen=_useState2[1];var showSettings=function showSettings(){return setSettingsOpen(true);};var closeSettings=function closeSettings(){return setSettingsOpen(false);};var _useState3=useState(ipcRenderer.sendSync('get-settings')),_useState4=_slicedToArray(_useState3,2),settings=_useState4[0],setSettings=_useState4[1];useEffect(function(){ipcRenderer.on(\"settings-changed\",function(event,newSettings){setSettings(newSettings);});},[]);var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),showLog=_useState6[0],setShowLog=_useState6[1];var toggleLog=function toggleLog(){return setShowLog(!showLog);};var _useState7=useState(\"\"),_useState8=_slicedToArray(_useState7,2),log=_useState8[0],setLog=_useState8[1];var addToLog=function addToLog(item){if(_log>log){return setLog(_log=_log+\"\\n\"+item);}setLog(_log=log+\"\\n\"+item);};var runAction=function runAction(_ref){var type=_ref.type,status=_ref.status,args=_ref.args,onComplete=_ref.onComplete,onProgress=_ref.onProgress,onError=_ref.onError,onData=_ref.onData,id=_ref.id;return new Promise(function(res,rej){addToLog(status);id=id||v4();var _onData=function _onData(_,msg){if(msg.id!==id)return;if(typeof onData===\"function\"){onData(msg);}};var _onProgress=function _onProgress(_,msg){if(msg.id!==id)return;if(typeof onProgress===\"function\"){onProgress(msg);}};var _onComplete=function _onComplete(_,msg){if(msg.id!==id)return;addToLog(msg.status);if(typeof onComplete===\"function\"){onComplete(msg);}cleanUp();res(msg);};var _onError=function _onError(_,msg){if(msg.id!==id)return;addToLog(msg.error);if(typeof onError===\"function\"){onError(msg);}cleanUp();rej(msg);};var cleanUp=function cleanUp(){ipcRenderer.off(\"data\",_onData);ipcRenderer.off(\"error\",_onError);ipcRenderer.off(\"progress\",_onProgress);ipcRenderer.off(\"complete\",_onComplete);};ipcRenderer.on(\"data\",_onData);ipcRenderer.on(\"error\",_onError);ipcRenderer.on(\"progress\",_onProgress);ipcRenderer.on(\"complete\",_onComplete);ipcRenderer.send(\"run-action\",_objectSpread({id:id,type:type},args));});};var sshTerm=function sshTerm(_ref2){var host=_ref2.host,username=_ref2.username,interactive=_ref2.interactive;var term=new Terminal({cols:80,rows:24});var id=v4();if(interactive){term.onData(function(data){ipcRenderer.send(\"run-action\",{type:\"ssh-data\",id:id,data:data});});ipcRenderer.on('data',function(_,msg){if(msg.id!==id)return;if([\"data\",\"error\"].includes(msg.type)){term.write(msg.data);}if(msg.type===\"exit-code\"){addToLog(\"exit status: \"+msg.code);}});}var startTerm=function startTerm(){return runAction({status:\"Starting ssh term \",type:\"start-ssh-term\",args:{host:host,interactive:interactive},id:id});};var curData={gathering:false,data:\"\"};var runCmd=function runCmd(_ref3){var cmd=_ref3.cmd,status=_ref3.status;return runAction({type:\"run-ssh-cmd\",status:status,id:id,args:{cmd:cmd},onData:function onData(msg){if([\"data\",\"error\"].includes(msg.type)){if(curData.gathering){curData.data+=msg.data;}term.write(msg.data);}if(msg.type===\"exit-code\"){addToLog(\"exit status: \"+msg.code);}}});};var runCmdInteractive=/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(_ref4){var cmd;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:cmd=_ref4.cmd;_context.next=3;return runAction({type:\"run-interactive\",args:{cmd:cmd,procID:id,ip:host}});case 3:case\"end\":return _context.stop();}}},_callee);}));return function runCmdInteractive(_x){return _ref5.apply(this,arguments);};}();var getOutput=/*#__PURE__*/function(){var _ref7=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(_ref6){var cmd,result;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:cmd=_ref6.cmd;curData.gathering=true;_context2.next=4;return runCmd({cmd:cmd,status:\"Gathering output for \".concat(cmd)});case 4:result=curData.data;curData.gathering=false;curData.data=\"\";return _context2.abrupt(\"return\",result);case 8:case\"end\":return _context2.stop();}}},_callee2);}));return function getOutput(_x2){return _ref7.apply(this,arguments);};}();var endTerm=function endTerm(){return runAction({status:\"Ending terminal session \".concat(username,\"@\").concat(host),type:\"end-ssh-term\",id:id});};return{term:term,runCmd:interactive?runCmdInteractive:runCmd,endTerm:endTerm,startTerm:startTerm,getOutput:getOutput};};var multiSSH=function multiSSH(_ref8){var ips=_ref8.ips,username=_ref8.username,interactive=_ref8.interactive;var processes=ips.map(function(ip){return _objectSpread(_objectSpread({},sshTerm({host:ip,username:username,interactive:interactive})),{},{ip:ip});});var runAll=/*#__PURE__*/function(){var _ref10=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(_ref9){var cmd,status;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:cmd=_ref9.cmd,status=_ref9.status;_context3.next=3;return Promise.all(processes.map(function(_ref11){var ip=_ref11.ip,runCmd=_ref11.runCmd;return runCmd({cmd:cmd,status:\"\".concat(status,\" on \").concat(ip)});}));case 3:case\"end\":return _context3.stop();}}},_callee3);}));return function runAll(_x3){return _ref10.apply(this,arguments);};}();var startAll=/*#__PURE__*/function(){var _ref12=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return Promise.all(processes.map(function(_ref13){var startTerm=_ref13.startTerm;return startTerm();}));case 2:return _context4.abrupt(\"return\",_context4.sent);case 3:case\"end\":return _context4.stop();}}},_callee4);}));return function startAll(){return _ref12.apply(this,arguments);};}();var endAll=/*#__PURE__*/function(){var _ref14=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(){return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.next=2;return Promise.all(processes.map(function(_ref15){var endTerm=_ref15.endTerm;return endTerm();}));case 2:return _context5.abrupt(\"return\",_context5.sent);case 3:case\"end\":return _context5.stop();}}},_callee5);}));return function endAll(){return _ref14.apply(this,arguments);};}();var getOutput=/*#__PURE__*/function(){var _ref17=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(_ref16){var cmd;return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:cmd=_ref16.cmd;_context6.next=3;return Promise.all(processes.map(function(_ref18){var getOutput=_ref18.getOutput;return getOutput(cmd);}));case 3:return _context6.abrupt(\"return\",_context6.sent);case 4:case\"end\":return _context6.stop();}}},_callee6);}));return function getOutput(_x4){return _ref17.apply(this,arguments);};}();return{processes:processes,runAll:runAll,startAll:startAll,endAll:endAll,getOutput:getOutput};};var _useState9=useState(ipcRenderer.sendSync(\"get-system-info\")),_useState10=_slicedToArray(_useState9,2),systemInfo=_useState10[0],setSystemInfo=_useState10[1];useEffect(function(){ipcRenderer.on(\"system-info-changed\",function(evt,msg){setSystemInfo(msg);});},[]);return/*#__PURE__*/React.createElement(Router,null,/*#__PURE__*/React.createElement(SettingsContext.Provider,{value:_objectSpread(_objectSpread({},settings),{},{showSettings:showSettings,closeSettings:closeSettings})},/*#__PURE__*/React.createElement(ActionsContext.Provider,{value:{runAction:runAction,addToLog:addToLog,sshTerm:sshTerm,multiSSH:multiSSH}},/*#__PURE__*/React.createElement(SystemInfoContext.Provider,{value:systemInfo},showLog?/*#__PURE__*/React.createElement(Log,{log:log}):\"\",/*#__PURE__*/React.createElement(\"div\",{className:\"App-container\"},/*#__PURE__*/React.createElement(\"img\",{src:LogIcon,alt:\"Log Icon\",className:\"log-icon\",onClick:toggleLog}),/*#__PURE__*/React.createElement(\"img\",{src:GearIcon,alt:\"Settings Icon\",className:\"settings-icon\",onClick:showSettings}),/*#__PURE__*/React.createElement(\"div\",{className:\"App\"},/*#__PURE__*/React.createElement(\"nav\",null,/*#__PURE__*/React.createElement(\"h1\",null,\"CRUSTER\"),/*#__PURE__*/React.createElement(\"div\",{className:\"justified-container\"},/*#__PURE__*/React.createElement(Link,{to:\"/image\"},/*#__PURE__*/React.createElement(\"div\",{className:\"btn btn-one\"},/*#__PURE__*/React.createElement(\"span\",null,\"Image\"))),/*#__PURE__*/React.createElement(Link,{to:\"/clusters\"},/*#__PURE__*/React.createElement(\"div\",{className:\"btn btn-one\"},/*#__PURE__*/React.createElement(\"span\",null,\"Clusters\"))))),/*#__PURE__*/React.createElement(\"main\",null,/*#__PURE__*/React.createElement(Settings,{closeSettings:closeSettings,settingsOpen:settingsOpen}),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(Switch,null,/*#__PURE__*/React.createElement(Route,{path:\"/clusters\"},/*#__PURE__*/React.createElement(Clusters,null)),/*#__PURE__*/React.createElement(Route,{path:\"/image\"},/*#__PURE__*/React.createElement(Image,null))))))))));}export default App;","map":{"version":3,"sources":["C:/Users/zwhit/dev/cruster/app/src/App.tsx"],"names":["React","useState","useEffect","BrowserRouter","Router","Switch","Route","Link","Clusters","Image","Settings","Log","SettingsContext","v4","ActionsContext","SystemInfoContext","Terminal","_log","App","settingsOpen","setSettingsOpen","showSettings","closeSettings","ipcRenderer","sendSync","settings","setSettings","on","event","newSettings","showLog","setShowLog","toggleLog","log","setLog","addToLog","item","runAction","type","status","args","onComplete","onProgress","onError","onData","id","Promise","res","rej","_onData","_","msg","_onProgress","_onComplete","cleanUp","_onError","error","off","send","sshTerm","host","username","interactive","term","cols","rows","data","includes","write","code","startTerm","curData","gathering","runCmd","cmd","runCmdInteractive","procID","ip","getOutput","result","endTerm","multiSSH","ips","processes","map","runAll","all","startAll","endAll","systemInfo","setSystemInfo","evt","LogIcon","GearIcon"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport {\r\n  BrowserRouter as Router,\r\n  Switch,\r\n  Route,\r\n  Link\r\n} from \"react-router-dom\";\r\nimport './App.css';\r\nimport Clusters from './Clusters/Clusters';\r\nimport Image from './Image/Image'\r\nimport Settings from './Cmpt/Settings';\r\nimport GearIcon from './Cmpt/GearIcon.svg'\r\nimport LogIcon from './Cmpt/LogIcon.svg'\r\nimport Log from './Cmpt/Log'\r\nimport SettingsContext from './Contexts/SettingsContext'\r\nimport { v4 } from 'uuid'\r\nimport ActionsContext from './Contexts/ActionsContext';\r\nimport SystemInfoContext from './Contexts/SystemInfoContext';\r\nimport { Terminal } from 'xterm'\r\nimport \"xterm/css/xterm.css\"\r\n\r\n\r\nlet _log = \"\"\r\nfunction App() {\r\n  const [settingsOpen, setSettingsOpen] = useState(false)\r\n  const showSettings = () => setSettingsOpen(true)\r\n  const closeSettings = () => setSettingsOpen(false)\r\n  const [settings, setSettings] = useState(ipcRenderer.sendSync('get-settings'))\r\n  useEffect(() => {\r\n    ipcRenderer.on(\"settings-changed\", (event, newSettings) => {\r\n      setSettings(newSettings)\r\n    })\r\n  }, [])\r\n\r\n  const [showLog,setShowLog] = useState(false)\r\n  const toggleLog = () => setShowLog(!showLog)\r\n  const [log, setLog] = useState(\"\")\r\n  const addToLog = item => {\r\n    if (_log > log) {\r\n      return setLog(_log = _log + \"\\n\" + item)\r\n    }\r\n    setLog(_log = (log + \"\\n\" + item))\r\n  }\r\n  const runAction = ({type, status, args, onComplete, onProgress, onError, onData, id}) => {\r\n    return new Promise((res,rej) => {\r\n      addToLog(status)\r\n      id = id || v4()\r\n      const _onData = (_, msg) => {\r\n        if (msg.id !== id) return\r\n        if (typeof onData === \"function\") {\r\n          onData(msg)\r\n        }\r\n      }\r\n      const _onProgress = (_, msg) => {\r\n        if (msg.id !== id) return\r\n        if (typeof onProgress === \"function\") {\r\n          onProgress(msg)\r\n        }\r\n      }\r\n      const _onComplete = (_, msg) => {\r\n        if (msg.id !== id) return\r\n        addToLog(msg.status)\r\n        if (typeof onComplete === \"function\") {\r\n          onComplete(msg)\r\n        }\r\n        cleanUp()\r\n        res(msg)\r\n      }\r\n      const _onError = (_, msg) => {\r\n        if (msg.id !== id) return\r\n        addToLog(msg.error)\r\n        if (typeof onError === \"function\") {\r\n          onError(msg)\r\n        }\r\n        cleanUp()\r\n        rej(msg)\r\n      }\r\n      const cleanUp = () => {\r\n        ipcRenderer.off(\"data\", _onData)\r\n        ipcRenderer.off(\"error\", _onError)\r\n        ipcRenderer.off(\"progress\", _onProgress)\r\n        ipcRenderer.off(\"complete\", _onComplete)\r\n      }\r\n\r\n      ipcRenderer.on(\"data\", _onData)\r\n      ipcRenderer.on(\"error\", _onError)\r\n      ipcRenderer.on(\"progress\", _onProgress)\r\n      ipcRenderer.on(\"complete\", _onComplete)\r\n\r\n      ipcRenderer.send(\"run-action\", {id, type, ...args})\r\n    })\r\n  }\r\n  const sshTerm = ({host, username, interactive}) => {\r\n    const term = new Terminal({ cols: 80, rows: 24})\r\n    const id = v4()\r\n    if (interactive) {\r\n      term.onData(data => {\r\n        ipcRenderer.send(\"run-action\", {\r\n          type: \"ssh-data\",\r\n          id,\r\n          data,\r\n        })\r\n      })\r\n      ipcRenderer.on('data', (_, msg) => {\r\n        if (msg.id !== id) return\r\n        if ([\"data\", \"error\"].includes(msg.type)) {\r\n          term.write(msg.data)\r\n        }\r\n        if (msg.type === \"exit-code\") {\r\n          addToLog(\"exit status: \" + msg.code)\r\n        }\r\n      })\r\n    }\r\n    const startTerm = () => runAction(({\r\n      status: \"Starting ssh term \",\r\n      type: \"start-ssh-term\",\r\n      args: {\r\n        host,\r\n        interactive,\r\n      },\r\n      id,\r\n    }) as any)\r\n    const curData = {\r\n      gathering: false,\r\n      data: \"\",\r\n    }\r\n    const runCmd = ({cmd, status}) => {\r\n      return runAction(({\r\n        type: \"run-ssh-cmd\",\r\n        status,\r\n        id,\r\n        args: {cmd},\r\n        onData: msg => {\r\n          if ([\"data\", \"error\"].includes(msg.type)) {\r\n            if (curData.gathering) {\r\n              curData.data += msg.data\r\n            }\r\n            term.write(msg.data)\r\n          }\r\n          if (msg.type === \"exit-code\") {\r\n            addToLog(\"exit status: \" + msg.code)\r\n          }\r\n        }\r\n      }) as any)\r\n    }\r\n    const runCmdInteractive = async ({cmd}) => {\r\n      // ipcRenderer.send(\"run-action\", {\r\n      //   type: \"ssh-data\",\r\n      //   id,\r\n      //   data: cmd + \"\\n\",\r\n      // })\r\n\r\n      await runAction({\r\n        type: \"run-interactive\",\r\n        args: {\r\n          cmd,\r\n          procID: id,\r\n          ip: host,\r\n        },\r\n      } as any)\r\n    }\r\n\r\n    const getOutput = async ({cmd}) => {\r\n      curData.gathering = true\r\n      await runCmd({cmd, status: `Gathering output for ${cmd}`})\r\n      const result = curData.data\r\n      curData.gathering = false\r\n      curData.data = \"\"\r\n      return result\r\n    }\r\n\r\n    const endTerm = () => (\r\n      runAction(({\r\n        status: `Ending terminal session ${username}@${host}`,\r\n        type: \"end-ssh-term\",\r\n        id,\r\n      }) as any)\r\n    )\r\n\r\n    return {\r\n      term,\r\n      runCmd: interactive ? runCmdInteractive : runCmd,\r\n      endTerm,\r\n      startTerm,\r\n      getOutput,\r\n    }\r\n  }\r\n\r\n  const multiSSH = ({ips, username, interactive}) => {\r\n    const processes = ips.map(ip => ({...sshTerm({host: ip, username, interactive}), ip}))\r\n    const runAll = async ({cmd, status}) => {\r\n      await Promise.all(processes.map(({ip, runCmd}) => runCmd({cmd, status: `${status} on ${ip}`})))\r\n    }\r\n    const startAll = async() => (\r\n      await Promise.all(processes.map(({startTerm}) => startTerm()))\r\n    )\r\n    const endAll = async() => (\r\n      await Promise.all(processes.map(({endTerm}) => endTerm()))\r\n    )\r\n    const getOutput = async({cmd}) => (\r\n      await Promise.all(processes.map(({getOutput}) => getOutput(cmd)))\r\n    )\r\n\r\n    return {\r\n      processes,\r\n      runAll,\r\n      startAll,\r\n      endAll,\r\n      getOutput\r\n    }\r\n  }\r\n\r\n\r\n  const [systemInfo, setSystemInfo] = useState(ipcRenderer.sendSync(\"get-system-info\"))\r\n  useEffect(() => {\r\n    ipcRenderer.on(\"system-info-changed\", (evt, msg) => {\r\n      setSystemInfo(msg)\r\n    })\r\n  }, [])\r\n\r\n  return (\r\n    <Router>\r\n    <SettingsContext.Provider value={{\r\n      ...settings,\r\n      showSettings,\r\n      closeSettings,\r\n      }}>\r\n    <ActionsContext.Provider value={{runAction, addToLog, sshTerm, multiSSH}} >\r\n    <SystemInfoContext.Provider value={systemInfo}>\r\n    {showLog ? <Log log={log} /> : \"\"}\r\n    <div className=\"App-container\">\r\n    <img\r\n      src={LogIcon}\r\n      alt=\"Log Icon\"\r\n      className=\"log-icon\"\r\n      onClick={toggleLog} />\r\n    <img\r\n      src={GearIcon}\r\n      alt=\"Settings Icon\"\r\n      className=\"settings-icon\"\r\n      onClick={showSettings} />\r\n    <div className=\"App\">\r\n      <nav>\r\n        <h1>CRUSTER</h1>\r\n        <div className=\"justified-container\">\r\n          <Link to=\"/image\">\r\n            <div className=\"btn btn-one\">\r\n              <span>Image</span>\r\n            </div>\r\n          </Link>\r\n          <Link to=\"/clusters\">\r\n          <div className=\"btn btn-one\">\r\n            <span>Clusters</span>\r\n          </div>\r\n          </Link>\r\n        </div>\r\n        {/* <pre>{JSON.stringify(nodes, null, 2)}</pre> */}\r\n      </nav>\r\n      <main>\r\n      <Settings {...({closeSettings, settingsOpen})} />\r\n      <br />\r\n      <Switch>\r\n        <Route path=\"/clusters\">\r\n          <Clusters />\r\n        </Route>\r\n        <Route path=\"/image\">\r\n          <Image />\r\n        </Route>\r\n      </Switch>\r\n      </main>\r\n    </div>\r\n    </div>\r\n    </SystemInfoContext.Provider>\r\n    </ActionsContext.Provider>\r\n    </SettingsContext.Provider>\r\n    </Router>\r\n  )\r\n}\r\n\r\nexport default App;"]},"metadata":{},"sourceType":"module"}