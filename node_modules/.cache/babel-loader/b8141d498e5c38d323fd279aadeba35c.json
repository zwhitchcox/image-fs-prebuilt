{"ast":null,"code":"import _regeneratorRuntime from\"C:\\\\Users\\\\zwhit\\\\dev\\\\cruster\\\\app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _asyncToGenerator from\"C:\\\\Users\\\\zwhit\\\\dev\\\\cruster\\\\app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:\\\\Users\\\\zwhit\\\\dev\\\\cruster\\\\app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import React,{useContext,useState}from'react';import SystemInfoContext from'../../Contexts/SystemInfoContext';import{Link,useHistory}from'react-router-dom';import ActionsContext from'../../Contexts/ActionsContext';var lastNumIP=function lastNumIP(ip){return Number(ip.split('.')[3]);};var sortByMasterIP=function sortByMasterIP(a,b){return lastNumIP(a.masterip)-lastNumIP(b.masterip);};var ManageClusters=function ManageClusters(){var _useContext=useContext(SystemInfoContext),nodes=_useContext.nodes;var clusters=Object.values(nodes).reduce(function(prev,cur){var masterip=cur.masterip,clustername=cur.clustername;if(!masterip)return prev;if(!prev[masterip]){prev[masterip]={clustername:clustername,masterip:masterip,master:{},slaves:[]};}if(cur.status===\"SLAVE\"){prev[masterip].slaves.push(cur);}else if(cur.status===\"MASTER\"){prev[masterip].master=cur;}return prev;},{});var clustersArr=Object.values(clusters);clustersArr.sort(sortByMasterIP);clustersArr=clustersArr.filter(function(cluster){return cluster.masterip!==\"\";});return/*#__PURE__*/React.createElement(\"div\",{className:\"boxed\"},/*#__PURE__*/React.createElement(\"h3\",null,\"Manage Clusters\"),Object.values(clusters).map(function(cluster){return/*#__PURE__*/React.createElement(Cluster,{key:cluster.masterip,cluster:cluster});}),/*#__PURE__*/React.createElement(Link,{to:\"/clusters/reset-all\"},/*#__PURE__*/React.createElement(\"button\",null,\"Go Nuclear - Reset All\")),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(Link,{to:\"/clusters/run-cmd-all\"},/*#__PURE__*/React.createElement(\"button\",null,\"Run Command on All Pis At Once\")));};var Cluster=function Cluster(_ref){var cluster=_ref.cluster;var history=useHistory();var _useContext2=useContext(ActionsContext),runAction=_useContext2.runAction;var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),kubeStatus=_useState2[0],setKubeStatus=_useState2[1];var downloadKube=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:setKubeStatus(\"Downloading...\");_context.prev=1;_context.next=4;return runAction({type:\"scp-download\",args:{ip:cluster.master.masterip,remotePath:\"/root/.kube/config\",localPath:ipcRenderer.sendSync(\"kube-config-path\")}});case 4:_context.next=9;break;case 6:_context.prev=6;_context.t0=_context[\"catch\"](1);setKubeStatus(_context.t0.toString());case 9:setKubeStatus(\"Copied successfully!\");case 10:case\"end\":return _context.stop();}}},_callee,null,[[1,6]]);}));return function downloadKube(){return _ref2.apply(this,arguments);};}();return/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"h4\",null,cluster.clustername),\"Master: \",/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"div\",{className:\"indent-1\"},cluster.master.ip,\"\\xA0\\xA0\",/*#__PURE__*/React.createElement(\"span\",{className:\"action\",onClick:function onClick(){return history.push(\"/clusters/node-ssh/\".concat(cluster.master.ip));}},\"ssh\"),/*#__PURE__*/React.createElement(\"span\",{className:\"action\",onClick:function onClick(){return history.push(\"/clusters/node-ssh/\".concat(cluster.master.ip,\"/reset\"));}},\"reset\")),\"Slaves: \",/*#__PURE__*/React.createElement(\"table\",{className:\"indent-1\"},/*#__PURE__*/React.createElement(\"tbody\",null,cluster.slaves.map(function(_ref3){var ip=_ref3.ip;return/*#__PURE__*/React.createElement(SlaveNode,{key:ip,ip:ip});}))),\"Actions:\",/*#__PURE__*/React.createElement(\"ul\",null,/*#__PURE__*/React.createElement(\"li\",null,/*#__PURE__*/React.createElement(\"span\",{className:\"action\",onClick:downloadKube},\"get kube config\"),\" \",kubeStatus)));};var SlaveNode=function SlaveNode(_ref4){var ip=_ref4.ip;var history=useHistory();return/*#__PURE__*/React.createElement(\"tr\",null,/*#__PURE__*/React.createElement(\"td\",null,ip,\"\\xA0\\xA0\"),/*#__PURE__*/React.createElement(\"td\",null,/*#__PURE__*/React.createElement(\"span\",{className:\"action\",onClick:function onClick(){return history.push(\"/clusters/node-ssh/\".concat(ip));}},\"ssh\")),/*#__PURE__*/React.createElement(\"td\",null,/*#__PURE__*/React.createElement(\"span\",{className:\"action\",onClick:function onClick(){return history.push(\"/clusters/node-ssh/\".concat(ip,\"/reset\"));}},\"reset\")));};export default ManageClusters;","map":{"version":3,"sources":["C:/Users/zwhit/dev/cruster/app/src/Clusters/Manage/ManageClusters.tsx"],"names":["React","useContext","useState","SystemInfoContext","Link","useHistory","ActionsContext","lastNumIP","ip","Number","split","sortByMasterIP","a","b","masterip","ManageClusters","nodes","clusters","Object","values","reduce","prev","cur","clustername","master","slaves","status","push","clustersArr","sort","filter","cluster","map","Cluster","history","runAction","kubeStatus","setKubeStatus","downloadKube","type","args","remotePath","localPath","ipcRenderer","sendSync","toString","SlaveNode"],"mappings":"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","sourcesContent":["import React, { useContext, useState } from 'react'\r\nimport SystemInfoContext from '../../Contexts/SystemInfoContext';\r\nimport { Link, useHistory } from 'react-router-dom';\r\nimport ActionsContext from '../../Contexts/ActionsContext';\r\n\r\nconst lastNumIP = ip => Number(ip.split('.')[3])\r\nconst sortByMasterIP = (a, b) => lastNumIP(a.masterip) - lastNumIP(b.masterip)\r\n\r\nconst ManageClusters = () => {\r\n  const {nodes} = useContext(SystemInfoContext)\r\n  const clusters = Object.values(nodes).reduce((prev, cur:any) => {\r\n    const {masterip, clustername} = cur\r\n    if (!masterip) return prev\r\n    if (!prev[masterip]) {\r\n      prev[masterip] = {\r\n        clustername,\r\n        masterip: masterip,\r\n        master: {} as any,\r\n        slaves: [] as any[],\r\n      }\r\n    }\r\n    if (cur.status === \"SLAVE\") {\r\n      prev[masterip].slaves.push(cur)\r\n    } else if (cur.status === \"MASTER\") {\r\n      prev[masterip].master = cur\r\n    }\r\n    return prev\r\n  }, ({} as any))\r\n  let clustersArr: any[] = Object.values(clusters)\r\n  clustersArr.sort(sortByMasterIP)\r\n  clustersArr = clustersArr.filter((cluster) => {\r\n    return cluster.masterip !== \"\"\r\n  })\r\n  return (\r\n    <div className=\"boxed\">\r\n      <h3>Manage Clusters</h3>\r\n      {Object.values(clusters).map((cluster:any) => <Cluster key={cluster.masterip} cluster={cluster} />)}\r\n      <Link to=\"/clusters/reset-all\">\r\n        <button>Go Nuclear - Reset All</button>\r\n      </Link>\r\n      <br />\r\n      <Link to=\"/clusters/run-cmd-all\">\r\n        <button>Run Command on All Pis At Once</button>\r\n      </Link>\r\n    </div>\r\n  )\r\n}\r\n\r\nconst Cluster = ({cluster}) => {\r\n  const history = useHistory()\r\n  const {runAction} = useContext(ActionsContext)\r\n  const [kubeStatus, setKubeStatus] = useState(\"\")\r\n  const downloadKube = async () => {\r\n    setKubeStatus(\"Downloading...\")\r\n    try {\r\n      await runAction({\r\n        type: \"scp-download\",\r\n        args: {\r\n          ip: cluster.master.masterip,\r\n          remotePath: \"/root/.kube/config\",\r\n          localPath: ipcRenderer.sendSync(\"kube-config-path\"),\r\n        }\r\n      })\r\n    } catch (error) {\r\n      setKubeStatus(error.toString())\r\n    }\r\n    setKubeStatus(\"Copied successfully!\")\r\n  }\r\n\r\n  return (\r\n    <div>\r\n      <h4>{cluster.clustername}</h4>\r\n      Master: <br /><div className=\"indent-1\">\r\n        {cluster.master.ip}&nbsp;&nbsp;\r\n        <span className=\"action\" onClick={() => history.push(`/clusters/node-ssh/${cluster.master.ip}`)}>ssh</span>\r\n        <span\r\n            className=\"action\"\r\n            onClick={() => history.push(`/clusters/node-ssh/${cluster.master.ip}/reset`)}\r\n          >reset</span>\r\n        </div>\r\n      Slaves: <table className=\"indent-1\">\r\n        <tbody>\r\n      {cluster.slaves.map(({ip}) => <SlaveNode key={ip} ip={ip} />)}\r\n        </tbody>\r\n      </table>\r\n      Actions:\r\n      <ul>\r\n        <li><span className=\"action\" onClick={downloadKube}>get kube config</span> {kubeStatus}</li>\r\n      </ul>\r\n    </div>\r\n  )\r\n}\r\nconst SlaveNode = ({ip}) => {\r\n  const history = useHistory()\r\n  return <tr>\r\n    <td>\r\n    {ip}&nbsp;&nbsp;\r\n    </td>\r\n    <td>\r\n      <span className=\"action\" onClick={() => history.push(`/clusters/node-ssh/${ip}`)}>ssh</span>\r\n    </td>\r\n    <td>\r\n    <span\r\n        className=\"action\"\r\n        onClick={() => history.push(`/clusters/node-ssh/${ip}/reset`)}\r\n      >reset</span>\r\n    </td>\r\n  </tr>\r\n}\r\n\r\nexport default ManageClusters"]},"metadata":{},"sourceType":"module"}